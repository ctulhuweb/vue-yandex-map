import{h as t}from"vue";function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=Array(e);o<e;o++)n[o]=t[o];return n}function o(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,s(n.key),n)}}function n(t,e,o){return(e=s(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function r(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)}return o}function a(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?r(Object(o),!0).forEach(function(e){n(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function i(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,o){if(t){if("string"==typeof t)return e(t,o);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,o):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){var o=e.options,n=e.callbacks,r=e.map,a=e.useObjectManager,s=e.objectManagerClusterize,c=e.useHtmlInLayout?'\n    <div v-html="properties.balloonContentHeader"></div>\n    <div v-html="properties.balloonContentBody"></div>\n    <div v-html="properties.balloonContentFooter"></div>\n  ':"\n    <div>{{ properties.balloonContentHeader }}</div>\n    <div>{{ properties.balloonContentBody }}</div>\n    <div>{{ properties.balloonContentFooter }}</div>\n  ",l={},u=[];if(t.forEach(function(t){t.clusterName?l[t.clusterName]=l[t.clusterName]?[].concat(i(l[t.clusterName]),[t]):[t]:u.push(t)}),Object.keys(l).forEach(function(t){var e=o[t]||{},i=n[t]||{},u=e.layout||c;e.clusterBalloonItemContentLayout=ymaps.templateLayoutFactory.createClass(u);var p=e.clusterBalloonLayout||e.clusterLayout;delete e.clusterBalloonLayout;var m=p?ymaps.templateLayoutFactory.createClass(p):e.clusterBalloonContentLayout||"cluster#balloonTwoColumns";e.clusterBalloonContentLayout=m;var d=e.clusterIconContentLayout;if(e.clusterIconContentLayout=d&&ymaps.templateLayoutFactory.createClass(d),a){var f=new ymaps.ObjectManager(Object.assign({clusterize:s},e));Object.keys(i).forEach(function(t){f.clusters.events.add(t,i[t])}),f.add(l[t]),r.geoObjects.add(f)}else{var y=new ymaps.Clusterer(e);Object.keys(i).forEach(function(t){y.events.add(t,i[t])}),e.createCluster&&(y.createCluster=e.createCluster),y.add(l[t]),r.geoObjects.add(y)}}),u.length){var p=a?new ymaps.ObjectManager({clusterize:!1}):new ymaps.GeoObjectCollection;u.forEach(function(t){return p.add(t)}),r.geoObjects.add(p)}}function u(t){return t.charAt(0).toUpperCase()+t.slice(1)}function p(t){return(t.icon.color||"blue")+(t.icon.glyph?u(t.icon.glyph):t.icon.content?"Stretchy":"")}function m(t){return t.map(function(t){return Array.isArray(t)?m(t):+t})}function d(t,e){var o=[];return function t(e,n){if(e===n)return!0;if(e instanceof Date&&n instanceof Date)return+e==+n;if("object"!==c(e)||"object"!==c(n))return!1;if(function(t,e){for(var n=o.length;n--;)if(!(o[n][0]!==t&&o[n][0]!==e||o[n][1]!==e&&o[n][1]!==t))return!0;return!1}(e,n))return!0;o.push([e,n]);var r=Object.keys(e),a=r.length;if(Object.keys(n).length!==a)return!1;for(;a--;)if(!t(e[r[a]],n[r[a]]))return!1;return!0}(t,e)}var f=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.events={},this.ymapReady=!1,this.scriptIsNotAttached=!0},(e=[{key:"$on",value:function(t,e){var o=this;return this.events[t]||(this.events[t]=[]),this.events[t].push(e),function(){o.events[t]=o.events[t].filter(function(t){return e!==t})}}},{key:"$emit",value:function(t,e){var o=this.events[t];o&&o.forEach(function(t){return t(e)})}}])&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}()),y=["fullscreenControl","geolocationControl","routeEditor","rulerControl","searchControl","trafficControl","typeSelector","zoomControl","routeButtonControl","routePanelControl"];function h(t){return 0===t.filter(function(t){return![].concat(y,["default"]).includes(t)}).length}function b(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(e,o){if(window.ymaps)return e();if(document.getElementById("vue-yandex-maps"))f.$on("scriptIsLoaded",e);else{var n=document.createElement("SCRIPT"),r=t.apiKey,a=void 0===r?"":r,i=t.suggestApiKey,s=void 0===i?"":i,c=t.lang,l=void 0===c?"ru_RU":c,u=t.version,p=void 0===u?"2.1":u,m=t.coordorder,d=void 0===m?"latlong":m,y=t.debug,h=void 0!==y&&y,b=t.enterprise,v=void 0!==b&&b,g=h?"debug":"release",k="lang=".concat(l).concat(a&&"&apikey=".concat(a),"&mode=").concat(g,"&coordorder=").concat(d);s&&(k+="&suggest_apikey=".concat(s));var O="https://".concat(v?"enterprise.":"","api-maps.yandex.ru/").concat(p,"/?").concat(k);n.setAttribute("src",O),n.setAttribute("async",""),n.setAttribute("defer",""),n.setAttribute("id","vue-yandex-maps"),document.head.appendChild(n),f.scriptIsNotAttached=!1,n.onload=function(){ymaps.ready(function(){f.ymapReady=!0,f.$emit("scriptIsLoaded"),e()})},n.onerror=o}})}var v,g=1;var k=f,O=["actionend","balloonclose","balloonopen","click","contextmenu","dblclick","destroy","hintclose","hintopen","optionschange","sizechange","typechange"],C={pluginOptions:{},provide:function(){var t,e,o,n,r,a,i=this,s=[],c=[];return null!=this.balloonComponent&&(n=this.balloonComponent,r=null,a="vue-balloon-".concat(g),g+=1,o=function(t,e){var o=ymaps.templateLayoutFactory.createClass('<div id="'.concat(a,'"><div>'),{build:function(){o.superclass.build.call(this),(r=new v({parent:t.$root,data:function(){return{props:t.$props,listeners:t.$listeners}},propsData:{marker:e,component:n}})).$mount("#".concat(a))},clear:function(){r.$destroy(),r=null,o.superclass.clear.call(this)}});return o}),{useObjectManager:this.useObjectManager,addMarker:this.addMarker,deleteMarker:function(e){i.$options.static.myMap.geoObjects&&(s.push(e),t&&clearTimeout(t),t=setTimeout(function(){i.deleteMarkers(s),s=[]},0))},compareValues:function(t){var o=t.newVal,n=t.oldVal,r=t.marker;d(o,n)||(c.push(r),e&&clearTimeout(e),e=setTimeout(function(){i.setMarkers(c),c=[]},0))},makeComponentBalloonTemplate:o}},data:function(){return{ymapId:"yandexMap".concat(Math.round(1e5*Math.random())),style:this.ymapClass?"":"width: 100%; height: 100%;",isReady:!1,debounce:null}},static:{myMap:{},markers:[]},props:{coords:{type:Array,required:!0},zoom:{validator:function(t){return!Number.isNaN(t)},default:18},bounds:Array,clusterOptions:{type:Object,default:function(){return{}}},clusterCallbacks:{type:Object,default:function(){return{}}},behaviors:{type:Array,default:function(){return["default"]}},controls:{type:Array,default:function(){return["default"]},validator:function(t){return h(t)}},detailedControls:{type:Object,validator:function(t){return h(Object.keys(t))}},scrollZoom:{type:Boolean,default:!0},mapType:{type:String,default:"map",validator:function(t){return["map","satellite","hybrid"].includes(t)}},placemarks:{type:Array,default:function(){return[]}},useObjectManager:{type:Boolean,default:!1},objectManagerClusterize:{type:Boolean,default:!0},ymapClass:String,initWithoutMarkers:{type:Boolean,default:!0},debug:{type:Boolean,default:!1},settings:{type:Object,default:function(){return{}}},options:{type:Object,default:function(){return{}}},mapEvents:{type:Array,default:function(){return[]}},showAllMarkers:Boolean,disablePan:Boolean,balloonComponent:{type:[Object,Function],default:function(){return null}},useHtmlInLayout:Boolean},computed:{coordinates:function(){return this.coords.map(function(t){return+t})}},methods:{init:function(){var t=this;if(window.ymaps&&ymaps.GeoObjectCollection&&(this.initWithoutMarkers||this.$slots.default||this.placemarks.length)){if(this.$emit("map-initialization-started"),this.$options.static.myMap=new ymaps.Map(this.ymapId,{center:this.coordinates,zoom:+this.zoom,bounds:this.bounds,behaviors:this.behaviors,controls:this.controls,type:"yandex#".concat(this.mapType)},this.options),(this.mapEvents.length?this.mapEvents:O).forEach(function(e){return t.$options.static.myMap.events.add(e,function(o){return t.$emit(e,o)})}),this.$options.static.myMap.events.add("boundschange",function(e){var o=e.originalEvent,n=o.newZoom,r=o.newCenter,a=o.newBounds;t.$emit("boundschange",e),t.$emit("update:zoom",n),t.$emit("update:coords",r),t.$emit("update:bounds",a)}),this.detailedControls)Object.keys(this.detailedControls).forEach(function(e){t.$options.static.myMap.controls.remove(e),t.$options.static.myMap.controls.add(e,t.detailedControls[e])});!1===this.scrollZoom&&this.$options.static.myMap.behaviors.disable("scrollZoom"),this.isReady=!0,this.$emit("map-was-initialized",this.$options.static.myMap)}},addMarker:function(t){var e=this;this.$options.static.markers.push(t),this.debounce&&clearTimeout(this.debounce),this.debounce=setTimeout(function(){e.setMarkers(e.$options.static.markers)},0)},setMarkers:function(t){var e=this,o={options:this.clusterOptions,callbacks:this.clusterCallbacks,map:this.$options.static.myMap,useObjectManager:this.useObjectManager,objectManagerClusterize:this.objectManagerClusterize,useHtmlInLayout:this.useHtmlInLayout};if(this.$options.static.markers!==t){var n=t.map(function(t){return e.useObjectManager?t.id:t.properties.get("markerId")});this.deleteMarkers(n),l(t,o),this.$emit("markers-was-change",n)}else l(t,o);this.$options.static.markers=[],this.showAllMarkers&&this.$options.static.myMap.setBounds(this.$options.static.myMap.geoObjects.getBounds())},deleteMarkers:function(t){var e=this;this.$options.static.myMap.geoObjects.each(function(o){var n=[];if(e.useObjectManager)o.remove(t);else{var r,a=function(e){var o=e.properties.get("markerId");t.includes(o)&&n.push(e)};if(o.each)o.each(a),r=o.getLength();else if(o.getGeoObjects){var i=o.getGeoObjects();i.forEach(a),r=i.length}0===r||r===n.length?e.$options.static.myMap.geoObjects.remove(o):n.length&&n.forEach(function(t){return o.remove(t)})}}),this.$emit("markers-was-delete",t)}},watch:{coordinates:function(t){this.disablePan?this.$options.static.myMap.setCenter&&this.$options.static.myMap.setCenter(t):this.$options.static.myMap.panTo&&this.$options.static.myMap.getZoom()&&this.$options.static.myMap.panTo(t,{checkZoomRange:!0})},zoom:function(){this.$options.static.myMap.setZoom(this.zoom)},bounds:function(t){this.$options.static.myMap.setBounds&&this.$options.static.myMap.setBounds(t)}},render:function(e){var o="function"==typeof e?e:t;return o("section",{class:"ymap-container",ref:"mapContainer"},[o("div","function"==typeof e?{attrs:{id:this.ymapId,class:this.ymapClass,style:this.style}}:{id:this.ymapId,class:this.ymapClass,style:this.style}),this.isReady&&o("div",["function"==typeof this.$slots.default?this.$slots.default():this.$slots.default])])},mounted:function(){var t=this;if(this.$attrs["map-link"]||this.$attrs.mapLink)throw new Error("Vue-yandex-maps: Attribute mapLink is not supported. Use settings.");if(this.placemarks&&this.placemarks.length)throw new Error("Vue-yandex-maps: Attribute placemarks is not supported. Use marker component.");this.mapObserver=new MutationObserver(function(){t.$options.static.myMap.container&&t.$options.static.myMap.container.fitToViewport()});var e=this.$refs.mapContainer;if(this.mapObserver.observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!1}),k.scriptIsNotAttached){var o=this.debug;b(a(a(a({},this.$options.pluginOptions),this.settings),{},{debug:o}))}k.ymapReady?ymaps.ready(this.init):k.$on("scriptIsLoaded",this.init)},beforeDestroy:function(){this.$options.static.myMap.geoObjects&&this.$options.static.myMap.geoObjects.removeAll()},beforeUnmount:function(){this.$options.static.myMap.geoObjects&&this.$options.static.myMap.geoObjects.removeAll()}},j=["placemark","polyline","rectangle","polygon","circle"],M=["balloonclose","balloonopen","click","contextmenu","dblclick","drag","dragend","dragstart","hintclose","hintopen","mouseenter","mouseleave"],$={inject:["useObjectManager","addMarker","deleteMarker","compareValues","makeComponentBalloonTemplate"],props:{coords:Array,hintContent:String,icon:Object,balloon:Object,markerType:{type:String,validator:function(t){return j.includes(t.toLowerCase())},default:"placemark"},markerFill:Object,markerStroke:Object,clusterName:[String,Number],circleRadius:{validator:function(t){return!Number.isNaN(t)},default:1e3},balloonTemplate:String,markerId:{type:[String,Number],required:!0},properties:Object,options:Object,balloonComponentProps:{type:Object,default:function(){return{}}},markerEvents:{type:Array,default:function(){return[]}}},data:function(){return{unwatchArr:[]}},render:function(e){var o="function"==typeof e?e:t;return this.$slots.balloon&&o("div",{style:"display: none;"},["function"==typeof this.$slots.balloon?this.$slots.balloon():this.$slots.balloon])},mounted:function(){var t=this;Object.keys(this.$props).forEach(function(e){"balloonComponentProps"!==e&&t.unwatchArr.push(t.$watch(e,function(e,o){return t.compareValues({newVal:e,oldVal:o,marker:t.defineMarker()})}))}),this.addMarker(this.defineMarker())},methods:{defineMarker:function(){var t=this,e={markerId:this.markerId,markerType:this.markerType||"placemark",coords:m(this.coords),hintContent:this.hintContent,markerFill:this.markerFill,circleRadius:+this.circleRadius,clusterName:this.clusterName,markerStroke:this.markerStroke,balloon:this.balloon,properties:this.properties,options:this.options,balloonOptions:{}},o=null;this.balloonTemplate&&(o=ymaps.templateLayoutFactory.createClass(this.balloonTemplate)),this.$slots.balloon&&(o=ymaps.templateLayoutFactory.createClass("function"==typeof this.$slots.balloon?this.$slots.balloon()[0].elm.outerHTML:this.$slots.balloon[0].elm.outerHTML)),this.makeComponentBalloonTemplate&&(o=this.makeComponentBalloonTemplate(this,e)),null!=o&&(e.balloonOptions.balloonContentLayout=o),this.icon&&["default#image","default#imageWithContent"].includes(this.icon.layout)?(e.iconContent=this.icon.content,e.iconLayout=this.icon.layout,e.iconImageHref=this.icon.imageHref,e.iconImageSize=this.icon.imageSize,e.iconImageOffset=this.icon.imageOffset,e.iconContentOffset=this.icon.contentOffset,this.icon.contentLayout&&"string"==typeof this.icon.contentLayout&&(e.iconContentLayout=ymaps.templateLayoutFactory.createClass(this.icon.contentLayout))):e.icon=this.icon;var n=function(t,e){var o=u(t);if(!e)return o;switch(o){case"Placemark":return"Point";case"Polyline":return"LineString";default:return o}}(e.markerType,this.useObjectManager),r={hintContent:e.hintContent,iconContent:e.icon?e.icon.content:e.iconContent,markerId:e.markerId},a=e.balloon?{balloonContentHeader:e.balloon.header,balloonContentBody:e.balloon.body,balloonContentFooter:e.balloon.footer}:{},i=Object.assign(r,a,e.properties),s=e.iconLayout?{iconLayout:e.iconLayout,iconImageHref:e.iconImageHref,iconImageSize:e.iconImageSize,iconImageOffset:e.iconImageOffset,iconContentOffset:e.iconContentOffset,iconContentLayout:e.iconContentLayout}:{preset:e.icon&&"islands#".concat(p(e),"Icon")},c=e.markerStroke?{strokeColor:e.markerStroke.color||"0066ffff",strokeOpacity:parseFloat(e.markerStroke.opacity)>=0?parseFloat(e.markerStroke.opacity):1,strokeStyle:e.markerStroke.style,strokeWidth:parseFloat(e.markerStroke.width)>=0?parseFloat(e.markerStroke.width):1}:{},l=e.markerFill?{fill:e.markerFill.enabled||!0,fillColor:e.markerFill.color||"0066ff99",fillOpacity:parseFloat(e.markerFill.opacity)>=0?parseFloat(e.markerFill.opacity):1,fillImageHref:e.markerFill.imageHref||""}:{},d=Object.assign(s,c,l,e.balloonOptions,e.options);"Circle"===n&&(e.coords=[e.coords,e.circleRadius]);var f=function(t,e){var o=e?{type:"Feature",id:t.properties.markerId,geometry:{type:t.markerType,coordinates:t.coords},properties:t.properties,options:t.options}:new ymaps[t.markerType](t.coords,t.properties,t.options);return o.clusterName=t.clusterName,o}({properties:i,options:d,markerType:n,coords:e.coords,clusterName:e.clusterName},this.useObjectManager,this.$emit);this.useObjectManager||(this.markerEvents.length?this.markerEvents:M).forEach(function(e){return f.events.add(e,function(o){return t.$emit(e,o)})});return f}},beforeDestroy:function(){this.unwatchArr.forEach(function(t){return t()}),this.deleteMarker(this.markerId)}},w=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w.installed||(w.installed=!0,function(t){"function"==typeof t.extend&&(v=t.extend({props:["marker","component"],template:'<component :is="component" v-bind="{ marker, ...props.balloonComponentProps }" v-on="listeners" />'}))}(t),C.pluginOptions=e,t.component("yandex-map",C),t.component("ymap-marker",$))};C.install=w,"undefined"!=typeof window&&window.Vue&&window.Vue.use(C);var I=b,L=C,S=$;export default C;export{I as loadYmap,L as yandexMap,S as ymapMarker};
